---
title: 使用 Go 与 MySQL 统计用户总量
createTime: 1626003217105
tags:
  - Go
  - MySQL
category: 记录
wip: true
---
柠喵的脑袋真的不是很靠谱，不记下来就会忘记，为了不让自己忘记更多研究成果，柠喵正在强迫自己每周起码写一篇文章来记录自己在工作时遇到的问题以及解决方案。

以上可能是废话，下面是这篇文章的目录：

<!--more-->
1. 需求分析和初版实现方案
2. 初版实现方案中存在的问题，以及改进方案
3. 完成改进方案时需要注意的问题

### 1. 需求分析和初版实现方案
公司给了一张用户表，要求通过这张表统计出每天的用户总量变化，以下是这张表经过简化后的样子：

| id | username | reg_time |
|---|---|---|
| 1 | LemonNeko | 1626003217105 |

其中，有一个叫做 `reg_time` 的字段记录了这个用户的注册时间。

#### 1.1 初版实现方案
柠喵想到的第一个方案是，设置一个开始时间 `a` 和结束时间 `b` ，进行循环，每循环一次将 `a` 的值增加一天，获取 `reg_time` 小于 `a` 的记录数量，直到等于 `b`。

假设开始时间是 7 天前的 0 点，结束时间是今天的 0 点：

```go
func main() {
    // 获取当前时间
    timeNow := time.Now()
    // 今天 0 点
    today := time.Date(timeNow.Year(), timeNow.Month(), timeNow.Day(), 0, 0, 0, 0, timeNow.Location())
    // 7 天前的 0 点，这里只减去 6 天是因为今天也算一天
    _7DaysAgo := today.Add(-6 * 24 * time.Hour)
}
```
